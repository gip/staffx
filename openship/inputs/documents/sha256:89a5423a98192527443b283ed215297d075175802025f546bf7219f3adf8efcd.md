---
kind: "Document"
hash: "sha256:89a5423a98192527443b283ed215297d075175802025f546bf7219f3adf8efcd"
title: "Feature: Notion and Google Integrations"
language: "en"
---

# Notion and Google Integrations

## Purpose
Enable secure OAuth connection lifecycle and document import readiness for external providers.

## Capabilities
- Start OAuth with state tracking and return URL sanitization.
- Exchange callback code for tokens and persist encrypted credentials.
- Refresh and revoke provider tokens.
- Report connection health states to clients.

## Workflow
- Integration authorize endpoints create short-lived OAuth state records.
- Callback validates state and provider, exchanges code, encrypts tokens, and stores integration status.
- Disconnect endpoint performs best effort revocation then marks integration as disconnected.

## Security controls
- Token encryption uses INTEGRATION_ENCRYPTION_KEY with AES-256-GCM payload format.
- Return URLs are constrained to trusted origin resolution logic.
- OAuth state has explicit expiration and single-use deletion semantics.

## Data touched
- integration_oauth_states
- user_integrations
- users for owner linkage

## Failure modes
- Invalid provider, state mismatch, and expired state rejection.
- External provider authorization and token exchange failures.
- Revocation failures are non-fatal and handled best effort.

## Source traceability
- apps/api/src/routes/integrations.ts
- apps/api/src/integrations/index.ts
- apps/api/src/integrations/notion.ts
- apps/api/src/integrations/google.ts
- apps/api/src/integrations/crypto.ts
