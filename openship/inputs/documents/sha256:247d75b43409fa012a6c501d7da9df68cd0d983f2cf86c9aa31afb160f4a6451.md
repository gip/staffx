---
kind: "Document"
hash: "sha256:247d75b43409fa012a6c501d7da9df68cd0d983f2cf86c9aa31afb160f4a6451"
title: "Feature: Assistant Run Orchestration"
language: "en"
---

# Assistant Run Orchestration

## Purpose
Queue and execute assistant actions while preserving timeline auditability and deterministic completion behavior.

## Capabilities
- Start direct or plan runs.
- Claim queued runs by runner identity.
- Complete or cancel runs.
- Persist completion messages and optional change records.
- Apply OpenShip bundle reconciliation during successful completion when files changed.

## Workflow
- Run start resolves prompt from explicit payload or prior chat message.
- Run start resolves active system prompt from root prompt document refs or default prompt text.
- Queue writes to agent_runs table and emits queue events.
- Desktop runner claims run, executes in local workspace, diffs OpenShip bundle, and posts completion payload.
- Completion endpoint finalizes run and optionally applies OpenShip updates through transactional apply pipeline.

## Data touched
- agent_runs
- actions
- messages
- changes
- systems and all OpenShip core tables during reconciliation

## Failure modes
- Invalid model or assistant type rejected.
- Claim conflicts return run unavailable.
- Reconciliation errors convert success completion into failed completion outcome.

## Source traceability
- apps/api/src/routes/v1.ts
- apps/api/src/agent-queue.ts
- apps/api/src/openship-sync.ts
- apps/api/src/agent-runner.ts
- apps/desktop/src/main/agent.ts
- packages/agent-runtime/src/index.ts
