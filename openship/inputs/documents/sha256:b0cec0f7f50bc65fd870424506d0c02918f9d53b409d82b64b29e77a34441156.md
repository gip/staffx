---
kind: "Document"
hash: "sha256:b0cec0f7f50bc65fd870424506d0c02918f9d53b409d82b64b29e77a34441156"
title: "Feature: Event Delivery, Polling, and SSE"
language: "en"
---

# Event Delivery, Polling, and SSE

## Purpose
Provide near real-time propagation of run and matrix lifecycle events to clients.

## Capabilities
- Cursor-based polling endpoint.
- Long-lived SSE endpoint with heartbeat and replay support.
- Deterministic cursor encoding and parsing.

## Workflow
- publishEvent inserts rows in staffx_events with type, aggregate identifiers, payload and version.
- Poll endpoint returns bounded ordered items plus next cursor.
- SSE endpoint sets stream headers, writes retry directive, sends heartbeat comments, and streams events with cursor ids.
- Web and desktop clients attempt SSE first and fall back to polling when stream fails.

## Data touched
- staffx_events table only for read and write operations.

## Failure modes
- Invalid cursor format rejected.
- Network failures trigger client fallback polling loop.

## Source traceability
- apps/api/src/events.ts
- apps/api/src/routes/v1.ts
- apps/web/src/app.tsx
- apps/desktop/src/renderer/app.tsx
