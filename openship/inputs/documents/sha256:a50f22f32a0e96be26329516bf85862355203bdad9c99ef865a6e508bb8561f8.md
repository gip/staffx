---
kind: Document
hash: sha256:a50f22f32a0e96be26329516bf85862355203bdad9c99ef865a6e508bb8561f8
title: API Interfaces and Endpoint Contracts (Active /v1)
language: en
---

This interface document defines active API contracts under /v1 with rebuild-oriented detail on authentication, validation, side effects, and failure patterns.

Global contract rules:
- Authentication: bearer token required on business endpoints except health and provider OAuth callback routes.
- Error model: validation and authorization failures return structured problem payloads with clear title/detail semantics.
- Identifier model: thread and project routes may accept UUIDs and project-scoped aliases where explicitly documented.
- Persistence model: mutating endpoints write PostgreSQL state and may publish domain events consumed by polling and SSE.

Service and identity endpoints:
- GET /v1/health: no auth. Returns service status and database liveness timestamp. No state changes.
- GET /v1/me: auth required. Returns resolved authenticated user profile from verified claims.
- GET /v1/users/search: auth required. Query parameter q required, non-empty. Returns top user matches by handle or name.
- GET /v1/users/:handle: optional auth. Returns target user profile and visible project memberships filtered by viewer access rules.

Integration endpoints:
- GET /v1/integrations: auth required. Returns provider status summary for notion and google.
- GET /v1/integrations/:provider/authorize: auth required. Validates provider, writes oauth state row, redirects to provider auth URL.
- GET /v1/integrations/:provider/authorize-url: auth required. Same state creation as authorize route, returns URL payload for client-side redirect.
- GET /v1/integrations/:provider/callback: no auth. Validates state and code, exchanges tokens, encrypts and stores credentials, clears oauth state, redirects with status markers.
- GET /v1/integrations/:provider/status: auth required. Returns connected, disconnected, expired, or needs_reauth based on stored status and expiry.
- POST /v1/integrations/:provider/disconnect: auth required. Best-effort provider token revoke and local disconnect state update.

Project lifecycle and governance endpoints:
- GET /v1/projects: auth required. Returns paginated visible projects with latest thread summaries and access roles.
- POST /v1/projects: auth required. Validates name/template/visibility, inserts project and initial system root, seeds concerns/template content, creates initial thread.
- GET /v1/projects/check-name: auth required. Validates owner-scoped project name availability.
- GET /v1/projects/:handle/:projectName/collaborators: auth required and access-checked. Returns settings payload with roles, concerns, visibility, and collaborators.
- PATCH /v1/projects/:handle/:projectName/description: owner/editor only. Updates nullable project description.
- PATCH /v1/projects/:handle/:projectName/visibility: owner only. Updates visibility state.
- POST /v1/projects/:handle/:projectName/archive: owner only. Archives project from active lists.
- POST /v1/projects/:handle/:projectName/roles: creates custom role if not duplicate.
- DELETE /v1/projects/:handle/:projectName/roles/:roleName: deletes role only if not currently assigned.
- POST /v1/projects/:handle/:projectName/concerns: creates concern if not duplicate.
- DELETE /v1/projects/:handle/:projectName/concerns/:concernName: deletes concern only if not referenced by matrix refs or artifacts.
- POST /v1/projects/:handle/:projectName/collaborators: adds collaborator membership.
- DELETE /v1/projects/:handle/:projectName/collaborators/:collaboratorHandle: removes collaborator membership.
- PUT /v1/projects/:handle/:projectName/collaborators/:collaboratorHandle/roles: replaces collaborator role assignments.

Thread and matrix endpoints:
- GET /v1/threads: auth required. Returns accessible thread list with pagination and optional project filter.
- POST /v1/threads: auth required. Creates new thread by cloning explicit source thread or latest project thread.
- GET /v1/threads/:threadId: auth required. Resolves by UUID or project thread id, returns thread detail with topology, matrix cells/docs, and timeline.
- PATCH /v1/threads/:threadId: auth required. Updates title/description/status (open, closed, committed transitions).
- DELETE /v1/threads/:threadId: auth required. Deletes thread.
- GET /v1/threads/:threadId/matrix: auth required. Returns scoped matrix and topology state.
- PATCH /v1/threads/:threadId/matrix: auth required. Updates node layout metadata and emits matrix-changed event.
- GET /v1/threads/:threadId/openship/bundle: auth required. Produces canonical OpenShip file bundle for reconciliation clients.
- POST /v1/threads/:threadId/chat: auth required. Appends user/system/assistant messages with role validation.

Assistant run endpoints:
- POST /v1/threads/:threadId/assistants/:assistantType/runs: auth required. Validates mode/model/prompt, queues run, emits run-started event.
- GET /v1/assistant-runs/:runId: auth required and thread-access checked. Returns run status and completion payloads.
- POST /v1/assistant-runs/:runId/claim: runner-authenticated path. Claims queued run for worker identity and emits progress event.
- POST /v1/assistant-runs/:runId/complete: validates completion payload, stores result/messages/changes, optionally reconciles OpenShip bundle into thread system, emits completed or failed event and chat session finished event.
- POST /v1/assistant-runs/:runId/cancel: transitions queued/running runs to cancelled, emits cancellation and chat session finished events.

Event endpoints:
- GET /v1/events: auth required. Cursor-based polling with deterministic ordering and nextCursor result.
- GET /v1/events/stream: auth required. SSE stream with resume support, heartbeat comments, and event frames.

Primary failure patterns:
- 400 for schema and validation failures (invalid params, malformed bundle files, unknown provider/template).
- 401/403 for missing authentication or insufficient project/thread permissions.
- 404 for missing user/project/thread/run resources.
- 409 for uniqueness or state-conflict conditions (duplicate names, role/concern collisions).
- 500 for unrecoverable runtime or dependency failures.

Out-of-runtime boundary:
- Source route files present but not wired in bootstrap remain excluded from this contract set until explicitly registered.
