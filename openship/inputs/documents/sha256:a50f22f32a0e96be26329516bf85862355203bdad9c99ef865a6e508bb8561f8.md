---
kind: Document
hash: sha256:a50f22f32a0e96be26329516bf85862355203bdad9c99ef865a6e508bb8561f8
title: API Interfaces and Endpoint Contracts (Active /v1)
language: en
---

Authentication and envelope rules: All business endpoints require Bearer authentication except health and OAuth callback paths. API returns RFC7807-style problem payloads for validation and authorization failures. IDs are UUIDs unless project/thread route aliases are explicitly accepted.

Endpoint group: service and identity. GET /v1/health returns service and database time readiness. GET /v1/me returns authenticated user profile resolved from bearer claims. GET /v1/users/search requires query q and returns user suggestions. GET /v1/users/:handle returns public profile plus visible shared projects with optional authenticated context.

Endpoint group: integrations. GET /v1/integrations returns provider status list for notion and google. GET /v1/integrations/:provider/authorize issues provider redirect and persists short-lived state. GET /v1/integrations/:provider/authorize-url returns redirect URL payload for client-side navigation. GET /v1/integrations/:provider/callback validates OAuth state, exchanges code, stores encrypted tokens, and redirects to return target with status markers. GET /v1/integrations/:provider/status returns connected, disconnected, expired, or needs_reauth state. POST /v1/integrations/:provider/disconnect revokes tokens best-effort and marks integration disconnected.

Endpoint group: projects list and creation. GET /v1/projects returns visible projects with pagination and optional name filter, including latest thread summaries. POST /v1/projects validates naming, visibility, and template, creates project/system/root node seed, concerns/template docs, and initial creation thread. GET /v1/projects/check-name checks owner-scoped project name availability.

Endpoint group: project settings and governance. GET /v1/projects/:handle/:projectName/collaborators returns access role, visibility, roles, concerns, and collaborator roster. PATCH /v1/projects/:handle/:projectName/description updates nullable description (owner or editor). PATCH /v1/projects/:handle/:projectName/visibility updates visibility (owner only). POST /v1/projects/:handle/:projectName/archive archives project (owner only). POST /v1/projects/:handle/:projectName/roles creates a role. DELETE /v1/projects/:handle/:projectName/roles/:roleName removes a role when not in use. POST /v1/projects/:handle/:projectName/concerns creates a concern. DELETE /v1/projects/:handle/:projectName/concerns/:concernName removes a concern when not in use by matrix refs or artifacts. POST /v1/projects/:handle/:projectName/collaborators adds a collaborator. DELETE /v1/projects/:handle/:projectName/collaborators/:collaboratorHandle removes a collaborator. PUT /v1/projects/:handle/:projectName/collaborators/:collaboratorHandle/roles replaces collaborator role assignments.

Endpoint group: thread lifecycle. GET /v1/threads returns accessible thread list with pagination and optional projectId scope. POST /v1/threads clones from source thread (explicit sourceThreadId or latest in project) and creates a new open thread. GET /v1/threads/:threadId resolves by UUID or project-thread-id and returns full thread payload including topology, matrix docs/cells, concerns, and chat timeline. PATCH /v1/threads/:threadId updates title, description, and status transitions among open, closed, committed. DELETE /v1/threads/:threadId deletes thread.

Endpoint group: matrix and OpenShip bundle. GET /v1/threads/:threadId/matrix returns scoped matrix/topology payload. PATCH /v1/threads/:threadId/matrix updates node layout positions and emits thread.matrix.changed events. GET /v1/threads/:threadId/openship/bundle generates canonical OpenShip file bundle and returns flattened file list for reconciliation clients.

Endpoint group: chat and assistant runs. POST /v1/threads/:threadId/chat appends chat action/message rows with role validation. POST /v1/threads/:threadId/assistants/:assistantType/runs queues assistant run (direct or plan) with model validation, prompt resolution, optional chat message linkage, and run-start events. GET /v1/assistant-runs/:runId returns run state with authorization by thread access. POST /v1/assistant-runs/:runId/claim claims queued run for runner identity and emits progress event. POST /v1/assistant-runs/:runId/complete validates status/messages, stores completion result, persists assistant completion chat messages, optionally reconciles OpenShip bundle files into thread system, emits completed or failed events, and emits chat.session.finished. POST /v1/assistant-runs/:runId/cancel transitions queued/running runs to cancelled and emits cancelled plus chat.session.finished events.

Endpoint group: events. GET /v1/events returns ordered events after optional cursor/timestamp with pageSize and nextCursor semantics. GET /v1/events/stream provides SSE stream, supports Last-Event-ID and since resume, writes heartbeat comments, and delivers event id/type/data frames for clients that need real-time updates.

Side effects and persistence: project and thread write endpoints mutate PostgreSQL entities and may fork new systems through SQL helper functions. Assistant completion can persist messages, changes, and OpenShip reconciliation writes across nodes, edges, documents, matrix refs, concerns, and artifacts. Event publication writes staffx_events rows for downstream polling and SSE delivery.

Out-of-runtime note: apps/api/src/routes/projects.ts and apps/api/src/routes/thread.ts are present but not registered in current index bootstrap and are excluded from active endpoint contract scope.
