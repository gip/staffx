---
kind: "Document"
hash: "sha256:6c0c8fead273f51dd2f1e0e74fc39c10820ab27c1b01f699f349d8a149f056bd"
title: "Feature: Authentication and Identity Flows"
language: "en"
---

# Authentication and Identity Flows

## Purpose
Provide consistent identity, authorization context, and user bootstrap across browser and desktop clients.

## Actors
- End user authenticating with Auth0.
- Auth0 service issuing access tokens.
- API service validating bearer tokens and creating user profiles.
- Optional Google identity provider when Auth0 social login uses Google.

## Workflow
- Web client uses Auth0 React provider and silent token retrieval for API calls.
- Desktop client runs PKCE authorization flow in main process and stores access token in process memory.
- API validates JWT using Auth0 JWKS and expected audience and issuer constraints.
- On first authenticated request, API fetches user profile from Auth0 userinfo and upserts a users row with generated handle fallback logic.

## Permissions and access model
- Access role to projects and threads is computed from owner relationship, collaborator grants, and project visibility.
- Owner and Editor have edit rights. Viewer has read-only rights.

## Data touched
- users table for identity persistence.
- projects, project_collaborators, and related views for access role derivation.

## Failure modes
- Missing or invalid bearer token produces unauthorized problem responses.
- Auth0 JWKS or userinfo failures produce auth or server failures.
- Handle collisions are retried during user creation.
- Missing AUTH0_DOMAIN or AUTH0_AUDIENCE prevents API startup.

## Source traceability
- apps/api/src/auth.ts
- apps/web/src/main.tsx
- apps/web/src/app.tsx
- apps/desktop/src/main/auth.ts
- apps/desktop/src/renderer/app.tsx
