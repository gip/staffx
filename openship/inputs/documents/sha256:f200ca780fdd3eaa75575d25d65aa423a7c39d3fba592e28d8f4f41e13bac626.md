---
kind: Document
hash: sha256:f200ca780fdd3eaa75575d25d65aa423a7c39d3fba592e28d8f4f41e13bac626
title: Integration Flows for Auth0, Google, and Notion
language: en
---

Integration flow specification covering identity federation and provider data access.

Auth0 identity flow:
- Web and desktop initiate login with Auth0.
- Auth0 issues access tokens consumed by API bearer authentication.
- Session and token refresh behavior remain client/provider responsibilities; API only validates bearer tokens.

Provider OAuth state lifecycle:
- API creates short-lived oauth state rows bound to user, provider, and return target.
- Provider callback validates state existence, provider match, and expiration before code exchange.
- Successful callback stores encrypted access and refresh tokens plus expiry metadata and connected status.
- Failed or expired callback paths clear invalid state and return explicit errors.

Google integration:
- OAuth provider path supports connection status and disconnect operations.
- API calls Google Docs APIs under user-scoped integration credentials.
- Expired token handling maps to expired or needs_reauth states based on refresh-token availability.

Notion integration:
- OAuth/provider lifecycle mirrors Google patterns with provider-specific token handling.
- API calls Notion APIs for external document access operations.

Disconnect flow:
- API attempts best-effort token revocation for both access and refresh tokens.
- Local integration row is marked disconnected and sensitive token fields are cleared.

Rebuild requirements:
1. Recreate oauth state store and expiry enforcement.
2. Recreate provider client adapters for authorize URL, code exchange, and revoke operations.
3. Recreate encrypted token storage at rest with key rotation plan.
4. Recreate status derivation logic from raw status, expiry, and refresh token presence.
5. Recreate callback redirect sanitization and allowed-origin checks.
